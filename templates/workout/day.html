{% extends "base.html" %}
{% block title %}{{ day.label }} — Week {{ plan.week_number }} — ForgeFit{% endblock %}
{% block content %}
<div class="gym-view">
    <div class="gym-header">
        <a href="{{ url_for('workout.plan') }}" class="back-link"><i data-feather="arrow-left" style="width:16px;height:16px;"></i> Back to plan</a>
        <h2>{{ day.label }}</h2>
        <p class="gym-sub">Week {{ plan.week_number }}</p>
    </div>

    <div class="gym-exercises">
        {% for ex in day.exercises %}
        <div class="gym-card {% if ex.is_compound %}gym-card-compound{% endif %}" id="exercise-{{ ex.id }}">

            <!-- Header: name + muscle badge + logged status -->
            <div class="gym-card-top">
                <div>
                    <div class="gym-card-name">{{ ex.name }}</div>
                    {% if ex.muscle_group %}
                        <span class="muscle-badge muscle-{{ ex.muscle_group }}">{{ ex.muscle_group | replace('_', ' ') | title }}</span>
                    {% endif %}
                </div>
                {% if logged_map.get(ex.id) %}
                    <span class="gym-logged-badge"><i data-feather="check-circle" style="width:16px;height:16px;"></i> Logged</span>
                {% endif %}
            </div>

            <!-- Tutorial link -->
            <a href="https://www.youtube.com/results?search_query={{ ex.name | urlencode }}+how+to+tutorial"
               target="_blank" rel="noopener" class="gym-tutorial-btn">
                <i data-feather="play-circle" style="width:14px;height:14px;"></i> Watch Tutorial
            </a>

            <!-- Sets / Reps / Weight -->
            <div class="gym-card-details">
                <div class="gym-stat">
                    <span class="gym-stat-value">{{ ex.sets }}</span>
                    <span class="gym-stat-label">Sets</span>
                </div>
                <div class="gym-stat">
                    <span class="gym-stat-value">{{ ex.reps }}</span>
                    <span class="gym-stat-label">Reps</span>
                </div>
                <div class="gym-stat">
                    <span class="gym-stat-value">{{ ex.weight_kg }}<small>kg</small></span>
                    <span class="gym-stat-label">Weight</span>
                </div>
            </div>

            <!-- AI setup notes (e.g. bench angle, machine settings) -->
            {% if ex.notes %}
                <div class="gym-card-notes"><i data-feather="info" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"></i>{{ ex.notes }}</div>
            {% endif %}

            <!-- Log actual reps/weight -->
            <div class="gym-log-form">
                <div class="gym-log-inputs">
                    <div class="gym-log-field">
                        <label>Actual Reps</label>
                        <input type="number" id="reps-{{ ex.id }}" min="0" placeholder="{{ ex.reps }}"
                            value="{{ logged_map[ex.id].actual_reps if logged_map.get(ex.id) else '' }}">
                    </div>
                    <div class="gym-log-field">
                        <label>Actual Weight (kg)</label>
                        <input type="number" id="weight-{{ ex.id }}" min="0" step="0.5" placeholder="{{ ex.weight_kg }}"
                            value="{{ logged_map[ex.id].actual_weight_kg if logged_map.get(ex.id) else '' }}">
                    </div>
                </div>
                <button class="btn btn-primary btn-small gym-log-btn" onclick="logExercise({{ ex.id }})">
                    {{ 'Update' if logged_map.get(ex.id) else 'Log' }}
                </button>
            </div>

            <!-- Personal note — persists across weeks and feeds into AI -->
            <div class="gym-user-notes">
                <label class="gym-user-notes-label">Personal note</label>
                <textarea id="note-{{ ex.id }}"
                          placeholder="e.g. too heavy, use cable instead, felt great at this weight..."
                          onblur="saveExerciseNote({{ ex.id }}, this.dataset.name)">{{ notes_map.get(ex.name.lower(), '') }}</textarea>
                <script>document.getElementById('note-{{ ex.id }}').dataset.name = {{ ex.name | tojson }};</script>
            </div>

        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
